### 整体架构：InnoDB存储架构是怎样的 ###



![9a308025a22c026f08e5ca8d919f59c8.jpg;,4,jpegx;3,700x.jpg](https://image.uc.cn/o/wemedia/s/upload/2020/9a308025a22c026f08e5ca8d919f59c8.jpg;,4,jpegx;3,700x.jpg)



---------

#### 工作原理：查询语句的底层执行流程是怎样的 ####

#####  MySQL客户端与服务器建立连接 #####

- 客户端通过mysql命令发起连接请求；

- 经过三次握手后与服务端建立TCP连接；

- 连接器接收到请求之后使用用户密码进行身份验证；

- 验证通过之后，获取用户的权限信息缓存起来，该连接后面都是基于该缓存中的权限执行sql；

  ![img](https://image.uc.cn/o/wemedia/s/upload/2020/d1fa64796b2258c85337596018de1ba4.jpg;,4,jpegx;3,700x.jpg)

  可以通过show processlist命令查看，自动断开连接，可以通过wait_timeout参数进行控制

  #### 执行SQL 

  - 服务端接收到客户端的查询sql之后，先尝试从查询缓存中查询该sql是否已经有缓存的结果了，如果有则直接返回结果，如果没有则执行下一步；

  - 分析器拿到sql之后会尝试对sql语句进行词法分析和语法分析，校验语法的正确性，通过之后继续往下执行；

  - 优化器拿到分析器的sql之后，开始继续解析sql，判断到需要走什么索引，根据实际情况重写sql，最终生成执行计划；

  - 执行器根据执行计划执行sql，执行之前会先进行操作权限校验；然后根据表存储引擎调用对饮接口进行查询数据，这里的扫描行数就是指的接口返回的记录数，执行器拿到返回记录之后进一步加工，如本例子：执行器拿到select * from t_user where user_id=10000的所有记录，在依次判断user_name是不是等于"arthinking"，获取到匹配的记录。

    ![438b7de18527a5b9a586bcea815d4df1.jpg;,4,jpegx;3,700x.jpg](https://image.uc.cn/o/wemedia/s/upload/2020/438b7de18527a5b9a586bcea815d4df1.jpg;,4,jpegx;3,700x.jpg)

    问题List:

    1.缓存的实现是怎么样子的

    2.命中缓存的架构是什么样子的，也就是说是缓存的数据结构是什么样子的，怎么构造的命中缓存的方式。

    ----------------

    ### InnoDB引擎架构

    

    

1. IO性能：文件IO操作写磁盘有哪几种方式，有什么IO优化方式 (3.1.2、关于磁盘IO的方式)
2. 缓存：InnoDB缓存(buffer pool, log buffer)的刷新方式有哪些（3.1.2.2、innodb_flush_method）
3. 缓存：log buffer是在什么时候写入到磁盘的（3.10.2、如何保证数据不丢失 - 其中第四步log buffer持久化到磁盘的时机为）
4. 缓存：为什么redo log prepare状态也要写磁盘？（3.10.2、如何保证数据不丢失 - 为什么第二步redo log prepare状态也要写磁盘？）
5. 缓存：脏页写盘一般发生在什么时候（3.10.2、如何保证数据不丢失 - 其中第五步：脏页刷新到磁盘的时机为）
6. 缓存：为什么唯一索引的更新不可以借助change buffer（3.2、Change Buffer）
7. 缓存：log buffer的日志刷盘控制参数innodb_flush_log_at_trx_commit对写性能有什么影响（3.4.1、配置参数）
8. 缓存：buffer pool的LRU是如何实现的，为什么要这样实现（3.1.1、缓冲池LRU算法）
9. 表存储：系统表空间的结构，MySQL InnoDB磁盘存储格式，各种表空间(系统表空间，独立表空间，通用表空间)的作用和优缺点是什么，ibdata、ibd、frm文件分别是干嘛的（3.5、表空间）
10. 行字段存储：底层页和行的存储格式（3.6、InnoDB底层逻辑存储结构）
11. 行字段存储：varchar，null底层是如何存储的，最大可用存储多大的长度（3.6.3.1、MySQL中varchar最大长度是多少）
12. 行字段存储：行记录太长了，一页存不下，该怎么存储？（3.6.3.2、行记录超过页大小如何存储）
13. 索引：数据库索引的组织方式是怎样的，明白为什么要采用B+树，而不是哈希表、二叉树或者B树（3.7、索引 - 为什么MySQL使用B+树）
14. 索引：索引组织方式是怎样的，为什么大字段会影响表性能(查询性能，更新性能)（3.7、索引）
15. 索引：覆盖索引、联合索引什么情况下会生效（3.7.2、辅助索引）
16. 索引：什么是索引下推，索引下推减少了哪方面的开销？（3.7.2、辅助索引 - 索引条件下推）
17. 索引：Change Buffer对二级索引DML语句有什么优化（3.2、Change Buffer）
18. 数据完整性：MySQL是如何保证数据完整性的，redo log、undo log和buffer pool数据完整性的关键作用分别是什么（3.10.2、如何保证数据不丢失）
19. MVCC：MVCC底层是怎么实现的，可重复读和读已提交是怎么实现的（3.11.2、MVCC实现原理）
20. 双写缓冲区有什么作用（3.9、Doublewrite Buffer）
21. Redo Log在一个事务中是在什么时候写入的？binlog和Redo Log有什么区别？（3.10.1、Redo Log在事务中的写入时机）